name: Gemini API Auto Report

on:
  push:
    branches: [ main ]
  workflow_dispatch: 
  schedule:
    - cron: '0 0 * * *'

jobs:
  build-and-report:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install SDK
        run: pip install -U google-generativeai

      - name: Generate API Report
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          python -c "
          import google.generativeai as genai
          import os
          from datetime import datetime

          api_key = os.getenv('GEMINI_API_KEY')
          genai.configure(api_key=api_key)

          with open('API_REPORT.md', 'w') as f:
              f.write('# üìä LAPORAN STATUS API GEMINI\n\n')
              f.write(f'> **Update Terakhir:** {datetime.now().strftime('%d %B %Y | %H:%M:%S')} GMT\n\n')
              
              f.write('### ‚úÖ Model yang Mendukung Penulisan (generateContent)\n')
              f.write('Gunakan ID Model di bawah ini pada skrip utama Anda untuk menghindari Error 404.\n\n')
              f.write('| ID Model (Gunakan ini) | Nama Tampilan | Status |\n')
              f.write('| :--- | :--- | :--- |\n')
              
              try:
                  models = list(genai.list_models())
                  for m in models:
                      if 'generateContent' in m.supported_generation_methods:
                          f.write(f'| **`{m.name}`** | {m.display_name} | Ready ‚úÖ |\n')
                  
                  f.write('\n\n### ‚ÑπÔ∏è Info Tambahan\n')
                  f.write('- Jika model yang Anda cari tidak ada, periksa region atau batasan API Key Anda.\n')
                  f.write('- Gunakan ID model yang dicetak tebal di atas untuk skrip otonom Anda.\n')
              except Exception as e:
                  f.write(f'\n\n> ‚ùå **CRITICAL ERROR:** {str(e)}\n')
          "

      - name: Commit and Push Report
        run: |
          git config --global user.name "Gemini-Reporter-Bot"
          git config --global user.email "bot@github.com"
          git add API_REPORT.md
          git commit -m "Update API Status Report [skip ci]" || echo "No changes"
          git push
